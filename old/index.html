<!DOCTYPE html>
<html>
    <head>
        <title>List</title>
        <link rel="stylesheet" href="/style.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <toshi-list file="/list.txt"></toshi-list>
        <footer class="floatingButtons">
            <toshi-button onclick="
                const eve = new CustomEvent('add', document.eventOptions);
                document.getElementsByTagName('toshi-list')[0].dispatchEvent(eve);
                " icon="nf-md-plus"></toshi-button>
            <toshi-button onclick="
                const eve = new CustomEvent('del', document.eventOptions);
                document.getElementsByTagName('toshi-list')[0].dispatchEvent(eve);
                " icon="nf-md-minus"></toshi-button>
            <toshi-button id="settings-button" icon="nf-oct-gear"></toshi-button>
            <toshi-button id="calendar-button" icon="nf-fa-calendar"></toshi-button>
        </footer>
        <dialog id="settings-dialog">
          <h1>controls</h1>
          <p>up/down: arrow keys or k/j</p>
		  <p>edit: i</p>
		  <p>save (in editing): enter</p>
		  <p>delete: del or backspace</p>
          <h1>settings (todo)</h1>
          <p>text size, buttons on left or right, details to show</p>
          <button id="settings-close">close</button>
        </dialog>
        <dialog id="calendar-dialog">
          <h1>meetings calendar</h1>
          <iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=1&bgcolor=%23ffffff&ctz=Asia%2FHong_Kong&src=bmVzdHNwYWNlMjNAZ21haWwuY29t&src=YWRkcmVzc2Jvb2sjY29udGFjdHNAZ3JvdXAudi5jYWxlbmRhci5nb29nbGUuY29t&src=ZW4uaG9uZ19rb25nI2hvbGlkYXlAZ3JvdXAudi5jYWxlbmRhci5nb29nbGUuY29t&color=%23039BE5&color=%2333B679&color=%230B8043" style="border:solid 1px #777" width="600" height="450" frameborder="0" scrolling="no"></iframe>
          <button id="calendar-close">close</button>
        </dialog>
        <script type='module'>
            document.eventList = ["up", "down", "add", "del", "edit", "save", "esc", "tab"];
            document.editingKeyList = {
                Enter: "save",
                Escape: "esc",
                Tab: "tab",
            };
            document.viewingKeyList = { 
                ArrowUp: "up",
                KeyK: "up",
                ArrowDown: "down",
                KeyJ: "down",
                Enter: "add",
                Delete: "del",
				Backspace: "del",
                KeyI: "edit",
            };
            document.optionalDetailsList = ["status", "deadline", "responsible", "creator", "lastEditor", "createdTime", "lastEditedTime"]
            document.eventOptions = { bubbles: true, cancelable: false, composed: true };
            document.nestSymbols = " \u2503\u2523\u2517\u2501\u2501";

            import {ToshiItem} from "/components/ToshiItem.js";
            window.customElements.define('toshi-item', ToshiItem);
            import {ToshiList} from "/components/ToshiList.js";
            window.customElements.define('toshi-list', ToshiList);
            import {ToshiButton} from "/components/ToshiButton.js";
            window.customElements.define('toshi-button', ToshiButton);

            document.addEventListener('keydown', (e) => {
                if ("Tab" == event.code) { e.preventDefault(); }
            });
            document.addEventListener('keyup', (e) => {
                if (document.getElementsByTagName("toshi-list")[0].editing){
                    for (const [k, e] of Object.entries(document.editingKeyList)) {
                        if (event.code == k) {
                            const eve = new CustomEvent(e, document.eventOptions);
                            document.getElementsByTagName("toshi-list")[0].dispatchEvent(eve);
                        }
                    }
                } else {
                    for (const [k, e] of Object.entries(document.viewingKeyList)) {
                        if (event.code == k) {
                            const eve = new CustomEvent(e, document.eventOptions);
                            document.getElementsByTagName("toshi-list")[0].dispatchEvent(eve);
                        }
                    }
                } 
            });
            document.querySelector("#settings-button").addEventListener("click", () => {
                document.querySelector("#settings-dialog").showModal();
            });
            document.querySelector("#settings-close").addEventListener("click", () => {
                document.querySelector("#settings-dialog").close();
            });
            document.querySelector("#calendar-button").addEventListener("click", () => {
                document.querySelector("#calendar-dialog").showModal();
            });
            document.querySelector("#calendar-close").addEventListener("click", () => {
                document.querySelector("#calendar-dialog").close();
            });
        </script>
    </body>
</html>

